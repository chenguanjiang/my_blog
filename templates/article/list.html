<!-- extendsè¡¨æ˜æ­¤é¡µé¢ç»§æ‰¿è‡ª base.html æ–‡ä»¶ -->
{% extends "base.html" %}
{% load static %}

<!-- å†™å…¥ base.html ä¸­å®šä¹‰çš„ title -->
{% block title %}
    åšå®¢åˆ—è¡¨
{% endblock title %}

<!-- å†™å…¥ base.html ä¸­å®šä¹‰çš„ content -->
{% block content %}

{% if messages %}
<ul id="__messages__" style="display:none">
    {% for message in messages %}
        <li>{{ message }}</li>
    {% endfor %}
</ul>
<script>
window.addEventListener('load', function(){
    var ul = document.getElementById('__messages__');
    if(!ul) return;
    var texts = [];
    for (var i = 0; i < ul.children.length; i++) {
        texts.push(ul.children[i].textContent);
    }
    if (!texts.length) return;
    if (window.layer && typeof window.layer.msg === 'function') {
        for (var j = 0; j < texts.length; j++) {
            (function(t, idx){
                setTimeout(function(){
                    window.layer.msg(t, {icon: 1, time: 1800});
                }, idx * 200);
            })(texts[j], j);
        }
    } else {
        alert(texts.join('\n'));
    }
});
</script>
{% endif %}

<!-- å®šä¹‰æ”¾ç½®æ–‡ç« æ ‡é¢˜çš„divå®¹å™¨ -->
<div class="container">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            {% if order == 'total_views' %}
            <li class="breadcrumb-item">
                <a href="{% url 'article:article_list' %}?order=created&search={{ search }}">æœ€æ–°</a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">æœ€çƒ­</li>
            {% else %}
            <li class="breadcrumb-item active" aria-current="page">æœ€æ–°</li>
            <li class="breadcrumb-item">
                <a href="{% url 'article:article_list' %}?order=total_views&search={{ search }}">æœ€çƒ­</a>
            </li>
            {% endif %}
        </ol>
    </nav>
    <!-- æ–°å¢ï¼Œæœç´¢æ  -->
    <div class="row">
        <div class="col-12 col-md-6">
            <form method="get" action="{% url 'article:article_list' %}">
                <input type="hidden" name="order" value="{{ order }}">
                <div class="input-group mb-2">
                    <input type="text" 
                        class="form-control" 
                        name="search" 
                        placeholder="æœç´¢æ–‡ç« ..." 
                        value="{{ search }}"
                    >
                    <div class="input-group-append">
                        <button type="submit" class="btn btn-primary">æŸ¥è¯¢</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- æ–°å¢ï¼Œæœç´¢æç¤ºè¯­ -->
    {% if search %}
        {% if articles %}
            <h4><span style="color: red">"{{ search }}"</span>çš„æœç´¢ç»“æœå¦‚ä¸‹ï¼š</h4>
            <hr>        
        {% else %}
            <h4>æš‚æ— <span style="color: red">"{{ search }}"</span>æœ‰å…³çš„æ–‡ç« ã€‚</h4>
            <hr>
        {% endif %}
    {% endif %}
    <div class="row mt-2">
        {% for article in articles %}
        <!-- æ–‡ç« å†…å®¹ -->
        <div class="col-12 col-md-4 mb-4">
        <!-- å¡ç‰‡å®¹å™¨ -->
            <div class="card h-100">
                
                <div class="card-header d-flex align-items-center justify-content-between">
                    <h4 class="mb-0 text-truncate">{{ article.title }}</h4>
                    {% if article.column %}
                        <span class="badge badge-info badge-pill d-inline-flex align-items-center" style="font-size:.85rem;">
                            <span aria-hidden="true">ğŸ“‚</span>
                            <span class="ml-1">{{ article.column }}</span>
                        </span>
                    {% endif %}
                </div>
                <!-- æ–‡ç« å›¾ -->
                {% if article.avatar %}
                    <div class="text-center mt-3">
                        <img src="{{ article.avatar.url }}" 
                             alt="avatar" 
                             style="max-width:100%; border-radius: 20px"
                        >
                    </div>
                {% endif %}
                <!-- æ‘˜è¦ -->
                <div class="card-body">
                    <p class="card-text">{{ article.body|slice:'100' }}...</p>
                </div>
                <div class="card-footer">
                    <div class="d-flex justify-content-between align-items-center">
                        {% if article.author.profile.avatar %}
                        <img src="{{ article.author.profile.avatar.url }}" alt="avatar" style="width:28px;height:28px;border-radius:50%;object-fit:cover;background-color:#fff;border:1px solid #dee2e6;">
                        {% endif %}
                        {% with aname=article.author|stringformat:"s" %}
                        <span class="text-primary">ä½œè€…ï¼š{{ aname|slice:":10" }}{% if aname|length > 10 %}...{% endif %}</span>
                        {% endwith %}
                    </div>
                    <div class="border-top my-2" style="border-color:#dee2e6;"></div>
                    {% if article.tags.all %}
                    <div class="d-block w-100 text-truncate mt-2">
                        <span class="mr-2"><span class="bg-warning text-dark px-2 py-0 rounded">æ ‡ç­¾</span></span>
                        {% for tag in article.tags.all %}
                            <a href="#" class="badge badge-danger mr-1" style="background-color: #f699b4; border-color: #f699b4;">{{ tag }}</a>
                        {% endfor %}
                    </div>
                    {% endif %}
                    <div class="border-top my-2" style="border-color:#dee2e6;"></div>
                    <div class="mt-2 d-flex justify-content-between align-items-center">
                        <a href="{% url 'article:article_detail' article.id %}" class="btn btn-primary btn-sm">é˜…è¯»æœ¬æ–‡</a>
                        <div class="d-flex align-items-center">
                            <span class="badge badge-pill badge-light text-secondary d-flex align-items-center mr-2">
                                <span aria-hidden="true">ğŸ‘ï¸</span>
                                <span class="ml-1">{{ article.total_views }}</span>
                            </span>
                            <span class="badge badge-pill badge-light text-secondary d-flex align-items-center">
                                <span aria-hidden="true">ğŸ’¬</span>
                                <span class="ml-1">{{ article.comment_count }}</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
<!-- é¡µç å¯¼èˆª -->
 <div class="pagination row">
    <div class="m-auto">
        <span class="step-links">
            <!-- å¦‚æœä¸æ˜¯ç¬¬ä¸€é¡µï¼Œåˆ™æ˜¾ç¤ºä¸Šç¿»æŒ‰é’® -->
            {% if articles.has_previous %}
                <a href="?order={{ order }}&search={{ search }}&page=1" class="btn btn-outline-secondary btn-sm rounded-pill">
                    &laquo; 1
                </a>
                <span class="mx-1 text-muted">â€¦</span>
                <a href="?order={{ order }}&search={{ search }}&page={{ articles.previous_page_number }}" 
                   class="btn btn-outline-primary btn-sm rounded-pill"
                >
                    {{ articles.previous_page_number }}
                </a>
            {% endif %}

            <!-- å½“å‰é¡µé¢ -->
            <span class="btn btn-primary btn-sm rounded-pill">
                {{ articles.number }}
            </span>

            <!-- å¦‚æœä¸æ˜¯æœ€æœ«é¡µï¼Œåˆ™æ˜¾ç¤ºä¸‹ç¿»æŒ‰é’® -->
            {% if articles.has_next %}
                <a href="?order={{ order }}&search={{ search }}&page={{ articles.next_page_number }}"
                   class="btn btn-outline-primary btn-sm rounded-pill"
                >
                    {{ articles.next_page_number }}
                </a>
                <span class="mx-1 text-muted">â€¦</span>
                <a href="?order={{ order }}&search={{ search }}&page={{ articles.paginator.num_pages }}"
                   class="btn btn-outline-secondary btn-sm rounded-pill"
                >
                    {{ articles.paginator.num_pages }} &raquo;
                </a>
            {% endif %}
        </span>
    </div>
</div>
{% endblock content %}
